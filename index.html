<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
 
 <title>PHP: Hypertext Preprocessor</title>
 
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
 
 <link rel="shortcut icon" href="http://static.php.net/www.php.net/favicon.ico" />
 <link rel="search" type="application/opensearchdescription+xml" href="http://www.php.net/phpnetimprovedsearch.src" title="Add PHP.net search" />
 <link rel="alternate" type="application/atom+xml" href="http://www.php.net/releases.atom" title="PHP Release feed" />
 <link rel="alternate" type="application/atom+xml" title="PHP: Hypertext Preprocessor" href="http://www.php.net/feed.atom" />
 <link rel="canonical" href="http://php.net/index.php" />
 
 <link rel="stylesheet" type="text/css" href="css/reset.css" media="all" /> 
 <link rel="stylesheet" type="text/css" href="css/structure.css" media="screen" />
 <link rel="stylesheet" type="text/css" href="css/doc.css" media="screen" />
 <link rel="stylesheet" type="text/css" href="css/theme.css" media="screen" />
 
 <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
 <script type="text/javascript" src="js/jquery.hoverIntent.minified.js"></script>
 <script type="text/javascript" src="js/common.js"></script>
 
</head>
<body>

<div id="headnav">
 
 <ul id="headmenu">
  <li id="headsearch">
    <form method="post" action="/search.php" id="topsearch">
    <input type="text" id="headsearch-keywords" name="pattern" value="Search..." size="30" accesskey="s" />
    <input type="submit"
          value="Go"
          id="headsearch-submit"
          class="submit" />
    </form>
  </li>
  <li id="headhome">
    <a href="/" rel="home" class="menu-link">Home</a>
  </li>
  <li>
    <a href="/downloads.php" class="menu-link">Downloads</a>
  </li>
  <li class="parent current">
    <a href="/docs.php" class="menu-link">Documentation</a>
    <div class="children"><div class="children-1"><div class="children-2">
    <dl>
        <dt><a href="#">Getting Started</a></dt>
        	<dd><a href="#">Preface</a></dd>
        	<dd><a href="#">Introduction</a></dd>
        	<dd><a href="#">A simple tutorial</a></dd>
        
        <dt><a href="#">Language Reference</a></dt>
        	<dd><a href="#">Basic syntax</a></dd>
        	<dd><a href="#">Types</a></dd>
        	<dd><a href="#">Variables</a></dd>
        	<dd><a href="#">Constants</a></dd>
        	<dd><a href="#">Expressions</a></dd>
        	<dd><a href="#">Operators</a></dd>
        	<dd><a href="#">Control Structures</a></dd>
        	<dd><a href="#">Functions</a></dd>
        	<dd><a href="#">Classes and Objects (PHP 4)</a></dd>
        	<dd><a href="#">Classes and Objects (PHP 5)</a></dd>
        	<dd><a href="#">Namespaces</a></dd>
        	<dd><a href="#">Exceptions</a></dd>
        	<dd><a href="#">References Explained</a></dd>
        	<dd><a href="#">Predefined variables</a></dd>
        	<dd><a href="#">Predefined Exceptions</a></dd>
        	<dd><a href="#">Predefined Interfaces</a></dd>
        	<dd><a href="#">Context options and parameters</a></dd>
        </dl>
        
        <dl style="width: 185px;">
        <dt><a href="#">Security</a></dt>
        	<dd><a href="#">Introduction</a></dd>
        	<dd><a href="#">General considerations</a></dd>
        	<dd><a href="#">Installed as CGI binary</a></dd>
        	<dd><a href="#">Installed as an Apache module</a></dd>
        	<dd><a href="#">Filesystem Security</a></dd>
        	<dd><a href="#">Database Security</a></dd>
        	<dd><a href="#">Error Reporting</a></dd>
        	<dd><a href="#">Using Register Globals</a></dd>
        	<dd><a href="#">User Submitted Data</a></dd>
        	<dd><a href="#">Magic Quotes</a></dd>
        	<dd><a href="#">Hiding PHP</a></dd>
        	<dd><a href="#">Keeping Current</a></dd>
        <dt><a href="#">Features</a></dt>
        	<dd><a href="#">HTTP authentication with PHP</a></dd>
        	<dd><a href="#">Cookies</a></dd>
        	<dd><a href="#">Sessions</a></dd>
        	<dd><a href="#">Dealing with XForms</a></dd>
        	<dd><a href="#">Handling file uploads</a></dd>
        	<dd><a href="#">Using remote files</a></dd>
        	<dd><a href="#">Connection handling</a></dd>
        	<dd><a href="#">Persistent Database Connections</a></dd>
        	<dd><a href="#">Safe Mode</a></dd>
        	<dd><a href="#">Using PHP from the command line</a></dd>
        </dl>
        
        <dl style="width: 275px;">
        <dt><a href="#">Function Reference</a></dt>
        	<dd><a href="#">Affecting PHP's Behaviour</a></dd>
        	<dd><a href="#">Audio Formats Manipulation</a></dd>
        	<dd><a href="#">Authentication Services</a></dd>
        	<dd><a href="#">Calendar and Event Related Extensions</a></dd>
        	<dd><a href="#">Command Line Specific Extensions</a></dd>
        	<dd><a href="#">Compression and Archive Extensions</a></dd>
        	<dd><a href="#">Credit Card Processing</a></dd>
        	<dd><a href="#">Cryptography Extensions</a></dd>
        	<dd><a href="#">Database Extensions</a></dd>
        	<dd><a href="#">File System Related Extensions</a></dd>
        	<dd><a href="#">Human Language and Char. Encoding Support</a></dd>
        	<dd><a href="#">Image Processing and Generation</a></dd>
        	<dd><a href="#">Mail Related Extensions</a></dd>
        	<dd><a href="#">Mathematical Extensions</a></dd>
        	<dd><a href="#">Non-Text MIME Output</a></dd>
        	<dd><a href="#">Process Control Extensions</a></dd>
        	<dd><a href="#">Other Basic Extensions</a></dd>
        	<dd><a href="#">Other Services</a></dd>
        	<dd><a href="#">Search Engine Extensions</a></dd>
        	<dd><a href="#">Server Specific Extensions</a></dd>
        	<dd><a href="#">Session Extensions</a></dd>
        	<dd><a href="#">Text Processing</a></dd>
        	<dd><a href="#">Variable and Type Related Extensions</a></dd>
        	<dd><a href="#">Web Services</a></dd>
        	<dd><a href="#">Windows Only Extensions</a></dd>
        	<dd><a href="#">XML Manipulation</a></dd>
        </dl>
        <dl style="width: 195px;">
        <dt><a href="#">Installation and Configuration</a></dt>
        <dt><a href="#">PHP at the Core</a></dt>
        <dt><a href="#">Frequently Asked Questions</a></dt>
        <dt><a href="#">Appendices</a></dt>
        </dl>
        <br style="clear: both;" />
    </div></div></div>
  </li>
  <li>
    <a href="/support.php" class="menu-link">Help</a>
  </li>
  <li>
    <a href="http://bugs.php.net/" class="menu-link">Bugs</a>
  </li>
  <li class="parent">
    <a href="/community/" class="menu-link">Community</a>
    <div class="children"><div class="children-1"><div class="children-2">
    <dl style="width: 300px;">
      <dt><a href="#">Conferences</a></dt>
        <dd><a href="#">All upcoming PHP conferences</a></dd>
        <dd><a href="#">Add a new conference</a></dd>
      <dt><a href="#">News</a></dt>
        <dd><a href="#">Recent headline 1 (Oct 6)</a></dd>
        <dd><a href="#">Another recent headline 1 (Oct 4)</a></dd>
        <dd><a href="#">Yet another headline with a lot of text (Oct 2)</a></dd>
    </dl>
    <dl>
      <dt><a href="#">Mailing lists</a></dt>
      <dt><a href="#">PHP Wiki</a></dt>
      <dt><a href="#">Useful links</a></dt>
      <dt><a href="#">Get Involved</a></dt>
        <dd><a href="#">Help fix bugs</a></dd>
        <dd><a href="#">Contribute code</a></dd>
        <dd><a href="#">Organize an event</a></dd>
        <dd><a href="#">Bake cookies</a></dd>
    </dl>
    <dl>
      <dt><a href="#">About PHP.net</a></dt>
        <dd><a href="#">Contribute to the website</a></dd>
        <dd><a href="#">Who's behind this?</a></dd>
        <dd><a href="#">Contact us</a></dd>
        <dd><a href="#">Etc.</a></dd>
    </dl>
    <br style="clear: both;" />
    </div></div></div>
  </li>
  
 </ul>
<br style="clear: both;" />
</div>

<div id="layout">
    <div class="layout-menu">
        <ul>
            <li><a href="#">Menu Section</a>
                <ul>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                </ul>
            </li>
            <li><a href="#">Menu Section</a>
                <ul>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                </ul>
            </li>
            <li><a href="#">Menu Section</a>
                <ul>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                    <li><a href="#">Menu item</a></li>
                </ul>
            </li>
        </dl>
    </div>
    <div class="layout-content">
        <div id="function.mysql-pconnect" class="refentry">
         <div class="refnamediv">
          <h1 class="refname">mysql_pconnect</h1>
          <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_pconnect</span> &mdash; <span class="dc-title">Open a persistent connection to a MySQL server</span></p>
        
         </div>
        
         <a name="function.mysql-pconnect.description"></a><div class="refsect1 description">
          <h3 class="title">Description</h3>
          <div class="methodsynopsis dc-description">
           <span class="type">resource</span> <span class="methodname"><b>mysql_pconnect</b></span>
            ([ <span class="methodparam"><span class="type">string</span> <tt class="parameter">$server</tt><span class="initializer">= ini_get(&quot;mysql.default_host&quot;)</span></span>
           [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$username</tt><span class="initializer">= ini_get(&quot;mysql.default_user&quot;)</span></span>
           [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$password</tt><span class="initializer">= ini_get(&quot;mysql.default_password&quot;)</span></span>
           [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$client_flags</tt></span>
          ]]]] )</div>
        
          
          <p class="para rdfs-comment">
           Establishes a persistent connection to a MySQL server.
          </p>
          
          <p class="para">
           <b>mysql_pconnect()</b> acts very much like
           <a href="function.mysql-connect.php" class="function">mysql_connect()</a> with two major differences.
          </p>
          <p class="para">
           First, when connecting, the function would first try to find a
           (persistent) link that&#039;s already open with the same host,
           username and password.  If one is found, an identifier for it
           will be returned instead of opening a new connection.
          </p>
          <p class="para">
           Second, the connection to the SQL server will not be closed when
           the execution of the script ends.  Instead, the link will remain
           open for future use (<a href="function.mysql-close.php" class="function">mysql_close()</a> will not
           close links established by <b>mysql_pconnect()</b>).
          </p>
          <p class="para">
           This type of link is therefore called &#039;persistent&#039;.
          </p>
         </div>
        
        
         <a name="function.mysql-pconnect.parameters"></a><div class="refsect1 parameters">
          <h3 class="title">Parameters</h3>
          <p class="para">
           </p><dl>
        
            <dt class="varlistentry">
        
             <span class="term"><i><tt class="parameter">server</tt></i>
        </span>
        
             </dt><dd class="listitem">
        
              <p class="para">
               The MySQL server. It can also include a port number. e.g. 
               &quot;hostname:port&quot; or a path to a local socket e.g. &quot;:/path/to/socket&quot; for 
               the localhost.
              </p>
              <p class="para">
               If the PHP directive <a href="mysql.configuration.php#ini.mysql.default-host" class="link">
               mysql.default_host</a> is undefined (default), then the default 
               value is &#039;localhost:3306&#039;
              </p>
             </dd>
        
            
            <dt class="varlistentry">
        
             <span class="term"><i><tt class="parameter">username</tt></i>
        </span>
        
             </dt><dd class="listitem">
        
              <p class="para">
               The username. Default value is the name of the user that owns the
               server process.
              </p>
             </dd>
        
            
            <dt class="varlistentry">
        
             <span class="term"><i><tt class="parameter">password</tt></i>
        </span>
        
             </dt><dd class="listitem">
        
              <p class="para">
               The password. Default value is an empty password.
              </p>
             </dd>
        
            
            <dt class="varlistentry">
        
             <span class="term"><i><tt class="parameter">client_flags</tt></i>
        </span>
        
             </dt><dd class="listitem">
        
              <p class="para">
               The <i><tt class="parameter">client_flags</tt></i>
         parameter can be a combination 
               of the following constants:
               128 (enable <i>LOAD DATA LOCAL</i> handling),
               <b><tt class="constant">MYSQL_CLIENT_SSL</tt></b>, 
               <b><tt class="constant">MYSQL_CLIENT_COMPRESS</tt></b>, 
               <b><tt class="constant">MYSQL_CLIENT_IGNORE_SPACE</tt></b> or
               <b><tt class="constant">MYSQL_CLIENT_INTERACTIVE</tt></b>.
              </p>
             </dd>
        
             
           </dl>
        <p>
          </p>
         </div>
        
        
         <a name="function.mysql-pconnect.returnvalues"></a><div class="refsect1 returnvalues">
          <h3 class="title">Return Values</h3>
          <p class="para">
           Returns a MySQL persistent link identifier on success, or <b><tt class="constant">FALSE</tt></b> on 
           failure.
          </p>
         </div>
        
         
         <a name="function.mysql-pconnect.changelog"></a><div class="refsect1 changelog">
          <h3 class="title">Changelog</h3>
          <p class="para">
           </p><table class="doctable informaltable">
            
             <thead valign="middle">
              <tr valign="middle">
               <th>Version</th>
               <th>Description</th>
              </tr>
        
             </thead>
        
             <tbody valign="middle" class="tbody">
              <tr valign="middle">
               <td align="left">4.3.0</td>
               <td align="left">
                Added the <i><tt class="parameter">client_flags</tt></i>
         parameter.
               </td>
              </tr>
        
             </tbody>
            
           </table>
        <p>
          </p>
         </div>
        
        
         <a name="function.mysql-pconnect.notes"></a><div class="refsect1 notes">
          <h3 class="title">Notes</h3>
          <blockquote><p><b class="note">Note</b>: 
           
            Note, that these kind of links only work if you are using
            a module version of PHP. See the
            <a href="features.persistent-connections.php" class="link">Persistent
            Database Connections</a> section for more information.
           <br />
          </p></blockquote>
          <div class="warning"><b class="warning">Warning</b>
           <p class="para">
            Using persistent connections can require a bit of tuning of your Apache
            and MySQL configurations to ensure that you do not exceed the number of
            connections allowed by MySQL.
           </p>
          </div>
          <blockquote><p><b class="note">Note</b>: 
           
            You can suppress the error message on failure by prepending 
            a <a href="language.operators.errorcontrol.php" class="link">@</a>
            to the function name.
           <br />
          </p></blockquote>
         </div>
        
        
         <a name="function.mysql-pconnect.seealso"></a><div class="refsect1 seealso">
          <h3 class="title">See Also</h3>
          <p class="para">
           </p><ul class="simplelist">
            <li class="member"><a href="function.mysql-connect.php" class="function" rel="rdfs-seeAlso">mysql_connect()</a> - Open a connection to a MySQL Server</li>
            <li class="member"><a href="features.persistent-connections.php" class="link">Persistent
            Database Connections</a></li>
           </ul><p>
          </p>
         </div>
        
        </div><br /><br /><!--UdmComment-->
        <div class="manualnavbar manualnavbar_bottom">
         <span class="next">
          <a href="function.mysql-ping.php">mysql_ping<img src="http://static.php.net/www.php.net/images/caret-r.gif" alt="&gt;" width="11" height="7" /></a>
         </span>
         <span class="prev">
          <a href="function.mysql-num-rows.php"><img src="http://static.php.net/www.php.net/images/caret-l.gif" alt="&lt;" width="11" height="7" />mysql_num_rows</a>
         </span>
         <hr />
         <span class="lastupdated">Last updated: Fri, 06 Mar 2009</span>
         <div class="langchooser">
          &nbsp;
         </div>
        </div>
        <!--/UdmComment-->
        
        
        <div id="usernotes">
         <div class="head">
          <span class="action"><a href="/manual/add-note.php?sect=function.mysql-pconnect&amp;redirect=http://www.php.net/manual/en/function.mysql-pconnect.php"><img src="http://static.php.net/www.php.net/images/notes-add.gif" alt="add a note" width="13" height="13" class="middle" /></a> <small><a href="/manual/add-note.php?sect=function.mysql-pconnect&amp;redirect=http://www.php.net/manual/en/function.mysql-pconnect.php">add a note</a></small></span>
          <small>User Contributed Notes</small><br />
          <strong>mysql_pconnect</strong>
         </div>
         <a name="85670"></a>
         <div class="note">
          <strong>david at hundsness dot com</strong><br />
          <a href="#85670">11-Sep-2008 05:44</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Here's a recap of important reasons NOT to use persistent connections:<br />
        <br />
        * When you lock a table, normally it is unlocked when the connection closes, but since persistent connections do not close, any tables you accidentally leave locked will remain locked, and the only way to unlock them is to wait for the connection to timeout or kill the process. The same locking problem occurs with transactions. (See comments below on 23-Apr-2002 &amp; 12-Jul-2003)<br />
        <br />
        * Normally temporary tables are dropped when the connection closes, but since persistent connections do not close, temporary tables aren't so temporary. If you do not explicitly drop temporary tables when you are done, that table will already exist for a new client reusing the same connection. The same problem occurs with setting session variables. (See comments below on 19-Nov-2004 &amp; 07-Aug-2006)<br />
        <br />
        * If PHP and MySQL are on the same server or local network, the connection time may be negligible, in which case there is no advantage to persistent connections.<br />
        <br />
        * Apache does not work well with persistent connections. When it receives a request from a new client, instead of using one of the available children which already has a persistent connection open, it tends to spawn a new child, which must then open a new database connection. This causes excess processes which are just sleeping, wasting resources, and causing errors when you reach your maximum connections, plus it defeats any benefit of persistent connections. (See comments below on 03-Feb-2004, and the footnote at <a href="http://devzone.zend.com/node/view/id/686#fn1" rel="nofollow" target="_blank">http://devzone.zend.com/node/view/id/686#fn1</a>)</span>
        </code></div>
          </div>
         </div>
         <a name="82813"></a>
         <div class="note">
          <strong>JM</strong><br />
          <a href="#82813">27-Apr-2008 04:16</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        If you get an error message which refers to a failure regarding /var/mysql/mysql.sock, try changing your php.ini so that mysql.default_socket=/tmp/mysql.sock</span>
        </code></div>
          </div>
         </div>
         <a name="77154"></a>
         <div class="note">
          <strong>Sabyasachi Ruj</strong><br />
          <a href="#77154">17-Aug-2007 08:00</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        If you are using mysql_pconnect(), and say the MySQL server has five persistent connection pooled for that client.<br />
        <br />
        Now mysql_pconnect can return any one of them.<br />
        <br />
        So, If you are expecting that mysql_pconnect will return always use the same persistent connection, that is not the case.<br />
        <br />
        So, say you are executing after connecting with mysql_pconnect:<br />
        <br />
        set @aa=6;<br />
        <br />
        And in another page you have again done mysql_pconnect, and executed:<br />
        <br />
        select @aa;<br />
        <br />
        That will not necessarily return '6' as the result!<br />
        <br />
        Because the second mysql_pconnect can take another persistent connection from that server's connection pool.</span>
        </code></div>
          </div>
         </div>
         <a name="68690"></a>
         <div class="note">
          <strong>Nils Meyer nils at weiss-bescheid dot de</strong><br />
          <a href="#68690">07-Aug-2006 01:03</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Be careful when setting variables on a persistent mysql connection. Example:<br />
        // Set result charset to UTF8<br />
        mysql_query("SET SESSION character_set_results = 'UTF8'");<br />
        <br />
        If another script reuses your persistent connection, it will also use the UTF-8 charset. This created a problem with typo3 and TemplaVoila, which reads serialized data from the database. The data is returned as UTF8, but the script expects latin1 and dies with a serialize error ("Template Object could not be unserialized successfully."). This problem is especially tricky because it works on some requests and crashes on others - because the variable is not set on all connections in the persistent connection pool.<br />
        <br />
        A possible solution is to reset variables to their default value afterwards:<br />
        $ret = mysql_query("SHOW VARIABLES LIKE 'character_set_results'"); <br />
        list($foo, $old_charset) = mysql_fetch_assoc($ret);<br />
        mysql_query("SET SESSION character_set_results = 'UTF8'");<br />
        // do some fancy utf8 stuff<br />
        // ..<br />
        <br />
        // revert to old encoding<br />
        mysql_query("SET SESSION character_set_results = '$old_charset'");<br />
        <br />
        or simply use mysql_connect(), as previously stated it makes more sense in most enviroments and there are less things to bother with&nbsp;&nbsp; (like variables, transactions, temporary tables).</span>
        </code></div>
          </div>
         </div>
         <a name="66385"></a>
         <div class="note">
          <strong>3ch0</strong><br />
          <a href="#66385">20-May-2006 09:01</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        pconnect is preferred when you are using a remote database server on a major web site. mysql in particular stays happier with 1 open connection as opposed to 1000 connections a minute =)</span>
        </code></div>
          </div>
         </div>
         <a name="56804"></a>
         <div class="note">
          <strong>Ron</strong><br />
          <a href="#56804">15-Sep-2005 03:34</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Here's a nifty little class which will load balance across multiple replicated MySQL server instances, using persistent connections, automatically removing failed MySQL servers from the pool.<br />
        <br />
        You would ONLY use this for queries, never inserts/updates/deletes, UNLESS you had a multi-master situation where updates to any database serverautomatically replicate to the other servers (I don't know whether that's possible with MySQL).<br />
        <br />
        Using this class, you get a connection to a MySQL server like this:<br />
        &nbsp;&nbsp;&nbsp; $con = MySQLConnectionFactory::create();<br />
        <br />
        Here is the class (you'll need to customize the $SERVERS array for your configuration -- note that you would probably use the same username, password and database for all of the servers, just changing the host name, but you're not forced to use the same ones):<br />
        <br />
        <span class="default">&lt;?php<br />
        </span><span class="keyword">class </span><span class="default">MySQLConnectionFactory </span><span class="keyword">{<br />
        &nbsp;&nbsp;&nbsp; static </span><span class="default">$SERVERS </span><span class="keyword">= array(<br />
        &nbsp;&nbsp;&nbsp; array(<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'host' </span><span class="keyword">=&gt; </span><span class="string">'myHost1'</span><span class="keyword">,<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'username' </span><span class="keyword">=&gt; </span><span class="string">'myUsername1'</span><span class="keyword">,<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'password' </span><span class="keyword">=&gt; </span><span class="string">'myPassword1'</span><span class="keyword">,<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'database' </span><span class="keyword">=&gt; </span><span class="string">'myDatabase1'</span><span class="keyword">),<br />
        &nbsp;&nbsp;&nbsp; array(<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'host' </span><span class="keyword">=&gt; </span><span class="string">'myHost2'</span><span class="keyword">,<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'username' </span><span class="keyword">=&gt; </span><span class="string">'myUsername1'</span><span class="keyword">,<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'password' </span><span class="keyword">=&gt; </span><span class="string">'myPassword2'</span><span class="keyword">,<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'database' </span><span class="keyword">=&gt; </span><span class="string">'myDatabase2'</span><span class="keyword">)<br />
        &nbsp;&nbsp;&nbsp; );<br />
        <br />
        &nbsp;&nbsp;&nbsp; public static function </span><span class="default">create</span><span class="keyword">() {<br />
        &nbsp;&nbsp;&nbsp; </span><span class="comment">// Figure out which connections are open, automatically opening any connections<br />
        &nbsp;&nbsp;&nbsp; // which are failed or not yet opened but can be (re)established.<br />
        &nbsp;&nbsp;&nbsp; </span><span class="default">$cons </span><span class="keyword">= array();<br />
        &nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">MySQLConnectionFactory</span><span class="keyword">::</span><span class="default">$SERVERS</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$server </span><span class="keyword">= </span><span class="default">MySQLConnectionFactory</span><span class="keyword">::</span><span class="default">$SERVERS</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$con </span><span class="keyword">= </span><span class="default">mysql_pconnect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$server</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">], </span><span class="default">$server</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]);<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!(</span><span class="default">$con </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)) {<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'database'</span><span class="keyword">], </span><span class="default">$con</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
        &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="string">'Could not select database: ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
        &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cons</span><span class="keyword">[] = </span><span class="default">$con</span><span class="keyword">;<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
        &nbsp;&nbsp;&nbsp; }<br />
        &nbsp;&nbsp;&nbsp; </span><span class="comment">// If no servers are responding, throw an exception.<br />
        &nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$cons</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception<br />
        &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(</span><span class="string">'Unable to connect to any database servers - last error: ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
        &nbsp;&nbsp;&nbsp; }<br />
        &nbsp;&nbsp;&nbsp; </span><span class="comment">// Pick a random connection from the list of live connections.<br />
        &nbsp;&nbsp;&nbsp; </span><span class="default">$serverIdx </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">count</span><span class="keyword">(</span><span class="default">$cons</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br />
        &nbsp;&nbsp;&nbsp; </span><span class="default">$con </span><span class="keyword">= </span><span class="default">$cons</span><span class="keyword">[</span><span class="default">$serverIdx</span><span class="keyword">];<br />
        &nbsp;&nbsp;&nbsp; </span><span class="comment">// Return the connection.<br />
        &nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$con</span><span class="keyword">;<br />
        &nbsp;&nbsp;&nbsp; }<br />
        }<br />
        </span><span class="default">?&gt;</span>
        </span>
        </code></div>
          </div>
         </div>
         <a name="48562"></a>
         <div class="note">
          <strong>tomek at 3kropki dot pl</strong><br />
          <a href="#48562">29-Dec-2004 05:36</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Instead of use wait_timeout, you can set interactive_timeout to short period of time (for ex. 20 sec.) this is a lot better solution in apache + mysql environment than wait_timeout.<br />
        <br />
        To know more about interactive_timeout - look to mysql documentation.</span>
        </code></div>
          </div>
         </div>
         <a name="47554"></a>
         <div class="note">
          <strong>federico dot chiesa at tiscali dot it</strong><br />
          <a href="#47554">20-Nov-2004 01:08</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Be very careful when using persistent connections and temporary tables on MySQL: in MySQL, temporary tables are visible only to the currenct connection, but if you have a persistent connection the temporary tables will supposedly be visible to everybody sharing the same persistent connection. This can lead to major trouble. I suggest to use totally random temporary table names when using persistent connections to avoid major problems.</span>
        </code></div>
          </div>
         </div>
         <a name="46913"></a>
         <div class="note">
          <strong>markunderscoreconnollyatacmdotorg</strong><br />
          <a href="#46913">27-Oct-2004 05:59</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        I would like to comment on the post from dfischer at qualcomm dot com that proposes spanning transactions over multiple application invocations, in case someone is bold enough to try it.<br />
        <br />
        I'll assume the table types being used are one of those that support transactions, such as InnoDB or BerkeleyDB.<br />
        <br />
        First, there is a question of whether this would work at all.&nbsp; To work at all, the transaction context would have to be preserved across all the invocations of the php code through the web server.&nbsp; Reading the description of <a href="http://www.php.net/manual/en/features.persistent-connections.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/features.persistent-connections.php</a> maintaining transaction context would be at best a coincidence.&nbsp; It would be interesting to find out that this does work on occasion and to understand the ramifications of such behavior.&nbsp; If I happened to get your connection and my action was a cancel, your updates might be gone. <br />
        <br />
        Second, if such a thing did work (occassionally or always), there would be performance implications as the underlying database managed transactions that were pretty much open-ended.&nbsp; A few long-running transactions would likely eat up many resources in a short time and the likelihood of concurrency conflicts could rise.&nbsp; If the mysql_pconnect behavior is to keep transaction open at the end of php processing, then it would probably be better to not define transactions when using mysql_pconnect. And, transactions that were never closed by code (user went out to lunch and got hit by a bus) could hold resources for quite some time (maybe until after rehab).<br />
        <br />
        So, even if such a scheme COULD work, it is not a good idea.&nbsp; The transaction should be committed or rolled back at the end of the user request processing.&nbsp; This allows the DBMS to properly manage resource ultilization and keeps bad things from happening to good data.&nbsp; If mysql_pconnect does not coordinate well with the transaction component of the database engine to always end a transaction at the end of processing a request, then mysql_pconnect should never be used where begin transaction is used.</span>
        </code></div>
          </div>
         </div>
         <a name="43869"></a>
         <div class="note">
          <strong>dfischer at qualcomm dot com</strong><br />
          <a href="#43869">07-Jul-2004 12:57</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        You also may consider using pconnect if you have transactions that span multiple pages. For example, in applications that I develop, I start a transaction on the moment I query selecting the data that the user plans on editing. I then commit the transactions after the user hits the submit button and the data is committed.<br />
        <br />
        I cannot simply use mysql_connect as then the connection would be terminated at the end of the page and if I did not commit my transaction, it is automatically rolled back.</span>
        </code></div>
          </div>
         </div>
         <a name="40671"></a>
         <div class="note">
          <strong>matt *at* roughest *dot* net</strong><br />
          <a href="#40671">11-Mar-2004 04:18</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Be very careful when using persistent connections on a machine running multiple mysql servers. You must specify the correct socket path, otherwise PHP will reuse connections irregardless of what server they are connected to. That is, it will see an open connection with matching parameters and use it, even if the connection is actually for a different server.</span>
        </code></div>
          </div>
         </div>
         <a name="39599"></a>
         <div class="note">
          <strong>mightye (at) mightye (dot) org</strong><br />
          <a href="#39599">04-Feb-2004 12:19</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Normally you do NOT want to use mysql_pconnect.&nbsp; This function is designed for environments which have a high overhead to connecting to the database.&nbsp; In a typical MySQL / Apache / PHP environment, Apache will create many child processes which lie in idle waiting for a web request to be assigned to them.&nbsp; Each of these child processes will open and hold its own MySQL connection.&nbsp; So if you have a MySQL server which has a limit of 50 connections, but Apache keeps more than 50 child processes running, each of these child processes can hold a connection to your MySQL server, even while they are idle (idle httpd child processes don't lend their MySQL connection to other httpd children, they hold their own).&nbsp; So even if you only have a few pages which actually connect to MySQL on a busy site, you can run out of connections, with all of them not actually being used.&nbsp; <br />
        <br />
        In general use mysql_connect() for connecting to MySQL unless that connection takes a long time to establish.</span>
        </code></div>
          </div>
         </div>
         <a name="39068"></a>
         <div class="note">
          <strong>aaryal at foresightint dot com</strong><br />
          <a href="#39068">15-Jan-2004 11:25</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        don't use pconnect in a situation with MySQL running on one host but on multiple ports (a multiple database configuration). the connection pooling algo in php apparently only keys off of the host, username and password but not the port. therefore, if you use the same host, username and password but a different port, you might get a connection that is connected to a different port than the one you asked for.</span>
        </code></div>
          </div>
         </div>
         <a name="37133"></a>
         <div class="note">
          <strong>spam at vrana dot cz</strong><br />
          <a href="#37133">04-Nov-2003 06:53</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Be warned if you use different parameters for mysql_pconnect() in different scripts on server: PHP can create single persistent connection for every set of parameters in each process up to mysql.max_persistent (PHP directive) per process. So even if you have MaxClients Apache directive set lesser then max_connections MySQL directive, you can easily get Too many connections MySQL error.<br />
        <br />
        If mysql.max_persistent is set to other value than -1 (unlimited, default value), connections over this limit are silently denied, so use it with care.<br />
        <br />
        Solution: For servers with potentially unlimited set of connection parameters, forbid persistent connection with mysql.allow_persistent=Off.</span>
        </code></div>
          </div>
         </div>
         <a name="34742"></a>
         <div class="note">
          <strong>script_this at yahoo dot com</strong><br />
          <a href="#34742">05-Aug-2003 06:41</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        in response to uthayakutty76 at yahoo dot com's&nbsp; <br />
        30-Jun-2003 12:31 post:<br />
        <br />
        -----------------------------------------------------------<br />
        ...The problem is that the connection to the MySQL <br />
        servers is interrupted very quickly or there is not <br />
        connection at all. We found out that when using the <br />
        domain of the server instead of "localhost" problems <br />
        occur.....<br />
        -----------------------------------------------------------<br />
        <br />
        try setting the wait_timeout variable in my.cnf for <br />
        mysql very high so the connections aren't ever idle for <br />
        that amount of time.&nbsp; ridiculous really, but it works for <br />
        localhost or remote database server where as the <br />
        localhost solution only works if the database is local i <br />
        think.</span>
        </code></div>
          </div>
         </div>
         <a name="34217"></a>
         <div class="note">
          <strong>pulstar at mail dot com</strong><br />
          <a href="#34217">18-Jul-2003 06:13</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        I had some problems when connecting to a remote server with mysql_pconnect and using the flag MYSQL_CLIENT_COMPRESS. Sometimes it connect, but many times it give me the error:<br />
        Warning: mysql_pconnect(): Unknown database 'XXXXX'<br />
        <br />
        If you have the same problem, try using mysql_connect instead. It worked fine for me. The script will take a long to reconnect each time the page is reloaded, but it will transfer data with compression. This is a little more secure than to send plain data over the Internet and also more faster when transmiting large amount of data.</span>
        </code></div>
          </div>
         </div>
         <a name="33994"></a>
         <div class="note">
          <strong>rochlin at centralpets dot com</strong><br />
          <a href="#33994">13-Jul-2003 03:27</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Do not use transactions (e.g. with InnoDB MySQL tables) with persistent connections.&nbsp; If your script stops or exits for any reason, your transaction will be left open and your locks will be left on.&nbsp; You have to reset MySQL to release them (so far as I can figure).&nbsp;&nbsp; They won't ROLLBACK automatically on error, like they ought to.&nbsp;&nbsp; When you restart the script, you'll get a new connection, so you can't rollback or commit for the previous script.&nbsp;&nbsp; Any script with a start transaction, rollback, or commit SQL statement should use regular (not persistent) connections.&nbsp;&nbsp; Seems like PHP ought to automatically issue a ROLLBACK on any open transactions when a script exits (error or otherwise) without a COMMIT.&nbsp; ZEND's site has a brief blurb on this.&nbsp; It's OK to mix/match so you use a persistent connection for the read stuff, but open a new regular connection conditionally (if you have to update, which is usually less often).</span>
        </code></div>
          </div>
         </div>
         <a name="31072"></a>
         <div class="note">
          <strong>rudenko at id.com.ua</strong><br />
          <a href="#31072">09-Apr-2003 02:15</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        You can solve problem with persistent connections setting directive mysql.allow_persistent = Off in php configuration file. The users whitch will try to create persistant connetion /mysql_pconnect()/ will be connected to db <br />
        with nonpersistant connection /mysql_connect()/<br />
        <br />
        For more info see user notes at section Persistant Connections. <a href="http://www.php.net/manual/en/features.persistent-connections.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/features.persistent-connections.php</a><br />
        --<br />
        <a href="http://www.id.com.ua" rel="nofollow" target="_blank">http://www.id.com.ua</a> Ilya Rudenko</span>
        </code></div>
          </div>
         </div>
         <a name="30244"></a>
         <div class="note">
          <strong>amn -at- frognet.net</strong><br />
          <a href="#30244">12-Mar-2003 06:45</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        Be careful using mysql_pconnect. If you are hosting on an ISP, they may frown upon you using multiple persistant mysql connections as this consumes resources for a longer period of time. If your script crashes, your connection can stay open for long periods of time. If there is a loop involved, you could accidently eat up all the available connections. That might be considered abuse by an ISP and you could get in trouble. Try using mysql_connect first instead. 90% of the time, a non-persistant mysql_connect call will do the trick just fine.</span>
        </code></div>
          </div>
         </div>
         <a name="26416"></a>
         <div class="note">
          <strong>fate_amendable_to_changeNOSPAM at yahoo dot com</strong><br />
          <a href="#26416">30-Oct-2002 11:58</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        To tell mysql_pconnect to connect to mysql on a port other than the default use a colon - eg<br />
        <br />
        mysql_pconnect("127.0.0.1:4444", "user", "pass")<br />
        <br />
        would connect to localhost on port 4444 <br />
        <br />
        (useful for ssh tunneling etc)</span>
        </code></div>
          </div>
         </div>
         <a name="20960"></a>
         <div class="note">
          <strong>david at acz dot org</strong><br />
          <a href="#20960">23-Apr-2002 06:41</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        You need to be VERY careful when using LOCK TABLES with persistent connections.&nbsp; If the script terminates before the UNLOCK TABLES is executed, the the table(s) will stay locked, and very likely hang future scripts.&nbsp; This is noted in a bug report, but is still not reflected in the documentation: <a href="http://bugs.php.net/bug.php?id=7634" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=7634</a></span>
        </code></div>
          </div>
         </div>
         <a name="19407"></a>
         <div class="note">
          <strong>bartek at bulzak dot com</strong><br />
          <a href="#19407">26-Feb-2002 10:37</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        PHP 4.1.1 running with Apache under Linux doesn't seem to be doing all necessary flushing when handling persistant mysql connections. Try it out for yourself. Create a temporary table in a pconnect session, add rows (non unique), select/display and drop the table. Now reload your script multiple times, you will see that your results are not consistent, even though you are creating a new table everytime and dropping it.. <br />
        <br />
        I had my share of problems with pconnect and suggest you don't use it unless absolutely necessary. In that case make sure you test your results for consistency, especially when your queries involve temporary tables or mysql session variables.<br />
        <br />
        Bartek Bulzak</span>
        </code></div>
          </div>
         </div>
         <a name="11798"></a>
         <div class="note">
          <strong>aramos at lander dot es</strong><br />
          <a href="#11798">07-Mar-2001 06:15</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        If your MySQL recive this error log: "Got an error reading communication packets" see this post: <a href="http://marc.theaimsgroup.com/?l=php-dev&amp;m=97858932431876&amp;w=2." rel="nofollow" target="_blank">http://marc.theaimsgroup.com/?l=php-dev&amp;m=97858932431876&amp;w=2.</a> This patch work property in 4.0.4pl1 (when httpd.conf have MaxRequestsPerChild non-cero)</span>
        </code></div>
          </div>
         </div>
         <a name="11792"></a>
         <div class="note">
          <strong>aramos at lander dot es</strong><br />
          <a href="#11792">07-Mar-2001 11:52</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        if you set wait_timeout, and you have high number of connection closed, you need too, set max_connect_errors (in MySQL) <a href="http://www.mysql.com/doc/en/Blocked_host.html" rel="nofollow" target="_blank">http://www.mysql.com/doc/en/Blocked_host.html</a></span>
        </code></div>
          </div>
         </div>
         <a name="5401"></a>
         <div class="note">
          <strong>sasha at mysql dot com</strong><br />
          <a href="#5401">28-Apr-2000 04:43</a>
          <div class="text">
        <div class="phpcode"><code><span class="html">
        If you need to close idle persistent connections, set a low wait_timeout in MySQL</span>
        </code></div>
          </div>
         </div>
         <div class="foot"><a href="/manual/add-note.php?sect=function.mysql-pconnect&amp;redirect=http://www.php.net/manual/en/function.mysql-pconnect.php"><img src="http://static.php.net/www.php.net/images/notes-add.gif" alt="add a note" width="13" height="13" class="middle" /></a> <small><a href="/manual/add-note.php?sect=function.mysql-pconnect&amp;redirect=http://www.php.net/manual/en/function.mysql-pconnect.php">add a note</a></small></div>
        </div><br /><!--UdmComment-->
        <div class="manualnavbar manualnavbar_bottom">
         <span class="next">
          <a href="function.mysql-ping.php">mysql_ping<img src="http://static.php.net/www.php.net/images/caret-r.gif" alt="&gt;" width="11" height="7" /></a>
         </span>
         <span class="prev">
          <a href="function.mysql-num-rows.php"><img src="http://static.php.net/www.php.net/images/caret-l.gif" alt="&lt;" width="11" height="7" />mysql_num_rows</a>
         </span>
         <hr />
         <span class="lastupdated">Last updated: Fri, 06 Mar 2009</span>
         <div class="langchooser">
          &nbsp;
         </div>
        </div>
        <!--/UdmComment-->
        
        
         </div>
         <div class="cleaner">&nbsp;</div>
        </div>
    </div>

</div>

</body>
</html>